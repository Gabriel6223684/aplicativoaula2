<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mini PHP Editor (Simulado)</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
        }

        .card {
            margin-bottom: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .table-actions {
            display: flex;
            gap: 5px;
        }

        #editorContainer {
            width: 100%;
            height: 300px;
            border: 1px solid #ccc;
        }

        .table td,
        .table th {
            vertical-align: middle;
        }
    </style>
</head>

<body>

    <div class="container my-5">
        <h1 class="text-center mb-4">Mini PHP Editor (Simulado)</h1>
        <div class="mb-4 text-end">
            <button class="btn btn-success" id="addTableBtn">Add New Table</button>
        </div>
        <div id="tablesContainer"></div>
    </div>

    <!-- Modal -->
    <div class="modal fade" id="editModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalTitle">Edit PHP Method</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div id="editorContainer"></div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button class="btn btn-primary" id="savePhpBtn">Save Method</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/monaco-editor@0.40.0/min/vs/loader.js"></script>
    <script>
        // ==== SIMULA PHP ====
        let phpMethods = {
            index: 'echo "Hello from index!";',
            show: 'echo "Hello from show!";',
            edit: 'echo "Hello from edit!";',
            delete: 'echo "Hello from delete!";',
            get: 'echo "Hello from get!";',
            post: 'echo "Hello from post!";'
        };

        // ==== UI e Tabelas ====
        const tablesContainer = document.getElementById('tablesContainer');
        const addTableBtn = document.getElementById('addTableBtn');
        let tableCount = 0;
        let editor = null;
        let currentMethod = '';

        function createTable(title = `Table ${tableCount + 1}`) {
            tableCount++;
            const card = document.createElement('div');
            card.classList.add('card');
            card.innerHTML = `
    <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
        <h5>${title}</h5>
        <div class="table-actions">
            <button class="btn btn-sm btn-light add-row">Add Row</button>
            <button class="btn btn-sm btn-danger remove-table">Delete Table</button>
        </div>
    </div>
    <div class="card-body">
        <table class="table table-striped table-hover">
            <thead class="table-dark"><tr><th>Setting</th><th>PHP Method</th><th>Actions</th></tr></thead>
            <tbody></tbody>
        </table>
    </div>`;
            tablesContainer.appendChild(card);

            const addRowBtn = card.querySelector('.add-row');
            const removeTableBtn = card.querySelector('.remove-table');
            const tbody = card.querySelector('tbody');

            addRowBtn.addEventListener('click', () => {
                const methods = Object.keys(phpMethods);
                if (methods.length === 0) return alert("Nenhum m√©todo PHP encontrado!");
                const selectHtml = `<select class="form-select form-select-sm method-select">${methods.map(m => `<option value="${m}">${m}</option>`).join('')}</select>`;
                const newRow = tbody.insertRow();
                newRow.innerHTML = `
            <td contenteditable="true">New Setting</td>
            <td>${selectHtml}</td>
            <td>
                <button class="btn btn-sm btn-outline-primary edit-btn">Edit PHP</button>
                <button class="btn btn-sm btn-outline-danger delete-btn">Delete</button>
            </td>`;
                attachRowEvents(newRow);
            });

            removeTableBtn.addEventListener('click', () => card.remove());
        }

        function attachRowEvents(row) {
            const editBtn = row.querySelector('.edit-btn');
            const deleteBtn = row.querySelector('.delete-btn');
            const methodSelect = row.querySelector('.method-select');

            editBtn.addEventListener('click', () => {
                currentMethod = methodSelect.value;
                document.getElementById('modalTitle').textContent = `Edit Method: ${currentMethod}`;
                const code = phpMethods[currentMethod] || '';

                if (!editor) {
                    require.config({ paths: { 'vs': 'https://cdn.jsdelivr.net/npm/monaco-editor@0.40.0/min/vs' } });
                    require(['vs/editor/editor.main'], function () {
                        editor = monaco.editor.create(document.getElementById('editorContainer'), {
                            value: code,
                            language: 'php',
                            theme: 'vs-dark',
                            automaticLayout: true
                        });
                    });
                } else { editor.setValue(code); }

                new bootstrap.Modal(document.getElementById('editModal')).show();
            });

            deleteBtn.addEventListener('click', () => row.remove());
        }

        document.getElementById('savePhpBtn').addEventListener('click', () => {
            if (!currentMethod) return alert('No method selected!');
            phpMethods[currentMethod] = editor.getValue();
            alert(`Method "${currentMethod}" updated!\n\nSimulated save successful.`);
        });

        createTable('Main Settings');
        addTableBtn.addEventListener('click', () => createTable());
    </script>
</body>

</html>